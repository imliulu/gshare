<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>共享剪贴板</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui-src/dist/css/layui.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        .layui-container {
            flex: 1;
        }
        footer {
            text-align: center;
            padding: 10px 0;
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
<div class="layui-container">
    <h1>共享剪贴板</h1>

    <!-- 返回首页按钮 -->
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="button" class="layui-btn" id="backToIndexBtn">返回首页</button>
        </div>
    </div>

    <!-- 房间信息 -->
    <div class="layui-form-item">
        <label class="layui-form-label">房间信息</label>
        <div class="layui-input-block">
            <input type="text" name="roomInfo" id="roomInfo" value="房间ID: {{.roomID}}, 密码: {{.password}}" readonly class="layui-input">
        </div>
    </div>

    <!-- 粘贴文本内容 -->
    <div class="layui-form-item">
        <label class="layui-form-label">粘贴文本</label>
        <div class="layui-input-block">
            <textarea name="clipboard" id="clipboardInput" required lay-verify="required" placeholder="请输入文本内容" class="layui-textarea"></textarea>
            <button type="button" class="layui-btn" id="pasteBtn">粘贴文本</button>
        </div>
    </div>

    <!-- 获取剪贴板内容 -->
    <div class="layui-form-item">
        <label class="layui-form-label">获取文本</label>
        <div class="layui-input-block">
            <button type="button" class="layui-btn" id="getClipboardBtn">获取文本</button>
            <div id="clipboardContents" class="layui-textarea" style="height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- 清空剪贴板内容 -->
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="button" class="layui-btn layui-btn-danger" id="clearClipboardBtn">清空剪贴板内容</button>
        </div>
    </div>
</div>
<footer>
    developed by LiuLu <a href="https://github.com/imliulu/gshare" target="_blank">GitHub</a>
</footer>

<script src="https://cdn.jsdelivr.net/npm/layui-src/dist/layui.js"></script>
<script>
layui.use(['layer', 'form'], function(){
    var layer = layui.layer;
    var form = layui.form;

    var roomID = document.getElementById('roomInfo').value.split(',')[0].split(':')[1].trim();

    // 返回首页
    document.getElementById('backToIndexBtn').addEventListener('click', function(){
        window.location.href = '/';
    });

    // 粘贴文本内容
    document.getElementById('pasteBtn').addEventListener('click', function(){
        var content = document.getElementById('clipboardInput').value;
        if(content){
            fetch('/api/rooms/' + roomID + '/clipboard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(content)
            })
            .then(response => response.json())
            .then(data => {
                layer.msg(data.message);
                document.getElementById('clipboardInput').value = '';
                fetchClipboardContents();
            })
            .catch(error => {
                layer.msg('粘贴失败: ' + error);
            });
        } else {
            layer.msg('请输入文本内容');
        }
    });

    // 获取剪贴板内容
    document.getElementById('getClipboardBtn').addEventListener('click', function(){
        fetchClipboardContents();
    });

    // 清空剪贴板内容
    document.getElementById('clearClipboardBtn').addEventListener('click', function(){
        fetch('/api/rooms/' + roomID + '/clipboard', {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            layer.msg(data.message);
            fetchClipboardContents();
        })
        .catch(error => {
            layer.msg('清空失败: ' + error);
        });
    });

    // 获取并显示剪贴板内容
    function fetchClipboardContents() {
        fetch('/api/rooms/' + roomID + '/clipboard')
        .then(response => response.json())
        .then(data => {
            var contentsDiv = document.getElementById('clipboardContents');
            contentsDiv.innerHTML = '';
            data.contents.forEach(function(content, index) {
                var contentElement = document.createElement('div');
                contentElement.textContent = (index + 1) + ". " + content;
                contentsDiv.appendChild(contentElement);
            });
        })
        .catch(error => {
            layer.msg('获取失败: ' + error);
        });
    }

    // 初始获取剪贴板内容
    fetchClipboardContents();
});
</script>
</body>
</html>
